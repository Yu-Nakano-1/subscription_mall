<div class="container my-5">

  <section class="text-center dark-grey-text">

    <h3 class="font-weight-bold pb-2 mb-4">現在利用できるチケット</h3>

    <p class="text-muted w-responsive mx-auto mb-5"></p>

    <div class="row">
    <% if @ticket.use_ticket_day == Date.today %>
    <div class="col-lg-4 col-md-12 mb-4">
      </div>

      <div class="col-lg-4 col-md-6 mb-4">

        <div class="card pricing-card">

          <div class="price header white-text indigo rounded-top">
            <h3 class="number"><%= @ticket.subscription_name %></h3>
            <div class="version">
              <h5 class="mb-0"><i class="fa fa-ticket fa-3x"></i></h5>
            </div>
          </div>

          <div class="card-body striped mb-1">

                <p class="mt-2"><i class="fa fa-check-circle fa"></i>巡グルメを利用するお店に行きQRコードをスキャン</p>

                <h3 class="number"><%= "本日のチケットは使用しました" %></h3>
          </div>
        </div>
      </div>

    <% elsif @ticket.issue_ticket_day == Date.today %>
      <div class="col-lg-4 col-md-12 mb-4">
      </div>

      <div class="col-lg-4 col-md-6 mb-4">

        <div class="card pricing-card">

          <div class="price header white-text indigo rounded-top">
            <h3 class="number"><%= @ticket.subscription_name %></h3>
            <div class="version">
              <h5 class="mb-0"><i class="fa fa-qrcode fa-3x"></i></h5>
            </div>
          </div>

          <div class="card-body striped mb-1">

                <p class="mt-2"><i class="fa fa-check-circle fa"></i>巡グルメを利用するお店に行きQRコードをスキャン</p>



                <label class="qrcode_button"><input type=file accept="image/*" capture=environment onchange="openQRCamera(this);" tabindex=-1>QRコード 読み取り画面へ移動</label>
          </div>
        </div>
      </div>
      <% else @ticket.issue_ticket_day != Date.today %>
      <h1>本日のチケットは発券されていません</h1>
    <% end %>
    </div>
  </section>
</div>


<script>
    function openQRCamera(node) {
  var reader = new FileReader();
  reader.onload = function() {
    node.value = "";
    qrcode.callback = function(res) {
      if(res instanceof Error) {
        alert("No QR code found. Please make sure the QR code is within the camera's frame and try again.");
      } else {
        node.parentNode.previousElementSibling.value = res;
      }
    };
    qrcode.decode(reader.result);
  };
  reader.readAsDataURL(node.files[0]);
}
</script>